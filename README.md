# Фильтр желтых новостей

## Как это работает

С новостного ресурса запрашивается статья, разбивается на токены (слова), токены
"нормируются" с помощью библиотеки pymorphy2, затем оценивается доля 
"заряженных" слов в тексте, она и является "коэффициентом желтизны".

"Заряженные" слова берутся из справочника.

Пока поддерживается только один новостной сайт - [ИНОСМИ.РУ](https://inosmi.ru/).
Для него разработан специальный адаптер, умеющий выделять текст статьи
на фоне остальной HTML разметки.
Для других новостных сайтов потребуются новые адаптеры,
все они будут находиться в каталоге `adapters`.
Туда же помещен код для сайта ИНОСМИ.PY: `adapters/inosmi_ru.py`.

## Как установить проект

Требуется Python>=3.7 и poetry

```bash
make install-dev    # install with dev-dependencies
make install        # install only runtime dependencies
```

## Как запустить сервер

```bash
poetry run serve    #  run aiohttp-based server
poetry run serve --help
```

или

```bash
make run    # собрать образ и запустить в docker-compose
make stop   # остановить docker-compose
```

сервер по умолчанию слушает порт `8080`

## Как запустить тесты

```bash
make tests              # запуск тестов
make tests-cov          # запуск тестов с coverage
make tests-cov-report   # запуск тестов с генерацией html отчета по coverage
```

## Кэш 

С кэшем возникло небольшое недопонимание.

Пакет `aiohttp-cache` был заброшен, сейчас его оживляют, но он сломан -
не работает с актуальной версией `aioredis`. Тем не менее я его прикрутил
установив с гитхаба из активной девелоперской ветки.
Но это почему-то сломало мне один импорт в тестах.

Поэтому попробовал прикрутить `aiocache`. Что-то из этого получилось,
и кажется даже достаточно симпатично. Сейчас этот вариант в мастере.

Первый вариант с `aiohttp-cache` - коммит `017be146985c27dc74271fae5439937dfc7b9a1c`

### Зачем так сложно с aiocache

Вариант просто завернуть что-нибудь в декоратор `aiocache.cached`, как нарисовано 
у них в example, мне показался мягко говоря не очень элегантным. Возможно
это просто вкусовщина, но подход с мидлварей мне нравится намного больше,
несмотря на то, что для одного эндпоинта это натуральный оверкилл.

## Цели проекта

Код написан в учебных целях.
Это урок из курса по веб-разработке — [Девман](https://dvmn.org).
